{% extends 'base.html' %}
{% block title %}–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤{% endblock %}

{% block content %}
<h1>–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤</h1>

<!-- –ü–æ–∏—Å–∫ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" class="d-flex">
            <input type="text" name="q" class="form-control me-2" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." value="{{ query }}">
            <button class="btn btn-outline-secondary" type="submit">üîç</button>
        </form>
    </div>
    <div class="col-md-6">
        <form method="get" class="d-flex">
            <!-- –ü–µ—Ä–µ–¥–∞—ë–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
            {% if query %}
                <input type="hidden" name="q" value="{{ query }}">
            {% endif %}
            <select name="order" class="form-select me-2" onchange="this.form.submit()">
                <option value="newest" {% if order == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                <option value="oldest" {% if order == 'oldest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                <option value="title_asc" {% if order == 'title_asc' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ê-–Ø</option>
                <option value="title_desc" {% if order == 'title_desc' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ø-–ê</option>
            </select>
        </form>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<a href="{% url 'films:add_film' %}" class="btn btn-primary mb-3">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</a>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-success alert-dismissible">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    {% endfor %}
{% endif %}

{% if films %}
    <div class="row">
        {% for film in films %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                    {% if film.image %}
                        <img src="{{ film.image.url }}" class="card-img-top" alt="–ü–æ—Å—Ç–µ—Ä: {{ film.title }}" style="height: 300px; object-fit: cover;">
                    {% else %}
                        <div class="bg-light text-center text-muted py-4" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            –ù–µ—Ç –ø–æ—Å—Ç–µ—Ä–∞
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ film.title }}</h5>
                        {% if film.description %}
                            <p class="card-text">{{ film.description|truncatewords:20 }}</p>
                        {% endif %}
                        {% if film.review %}
                            <small><strong>–û—Ç–∑—ã–≤:</strong> {{ film.review|truncatewords:15 }}</small>
                        {% endif %}
                        <br>
                        <small class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: {{ film.created_at|date:"d.m.Y H:i" }}</small>
                    </div>
                    <div class="card-footer">
                        <a href="{% url 'films:edit_film' film.pk %}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <form method="post" action="{% url 'films:delete_film' film.pk %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º?');">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞. <a href="{% url 'films:add_film' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</a></p>
{% endif %}

{% endblock %}